{
  "comments": [
    {
      "key": {
        "uuid": "852aade1_079ba23c",
        "filename": "tools/pci.cpp",
        "patchSetId": 1
      },
      "lineNbr": 122,
      "author": {
        "id": 1000233
      },
      "writtenOn": "2021-02-26T18:18:57Z",
      "side": 1,
      "message": "should call through the pci object instead of calling the library directly",
      "range": {
        "startLine": 122,
        "startChar": 4,
        "endLine": 122,
        "endChar": 21
      },
      "revId": "38068f143eb1f174b7ddc27cf6fd7be51741fac1",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5f7c3253_390c6fd0",
        "filename": "tools/pci.cpp",
        "patchSetId": 1
      },
      "lineNbr": 122,
      "author": {
        "id": 1000590
      },
      "writtenOn": "2021-03-08T19:26:39Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "852aade1_079ba23c",
      "range": {
        "startLine": 122,
        "startChar": 4,
        "endLine": 122,
        "endChar": 21
      },
      "revId": "38068f143eb1f174b7ddc27cf6fd7be51741fac1",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "556bc2a1_f00dec3f",
        "filename": "tools/pci.cpp",
        "patchSetId": 1
      },
      "lineNbr": 139,
      "author": {
        "id": 1000233
      },
      "writtenOn": "2021-02-26T18:18:57Z",
      "side": 1,
      "message": "do we still need the cfg write if we\u0027re using pci_device_enable?",
      "range": {
        "startLine": 139,
        "startChar": 15,
        "endLine": 139,
        "endChar": 38
      },
      "revId": "38068f143eb1f174b7ddc27cf6fd7be51741fac1",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9dccc5bb_7257076e",
        "filename": "tools/pci.cpp",
        "patchSetId": 1
      },
      "lineNbr": 139,
      "author": {
        "id": 1001030
      },
      "writtenOn": "2021-02-26T18:34:48Z",
      "side": 1,
      "message": "If all this is doing is setting MMIO enable bit, this should go away.\n\nI was under the impression there was some device specific thing happening, if not, then yeah by all means get rid of that (and corresponding code in the header).",
      "parentUuid": "556bc2a1_f00dec3f",
      "range": {
        "startLine": 139,
        "startChar": 15,
        "endLine": 139,
        "endChar": 38
      },
      "revId": "38068f143eb1f174b7ddc27cf6fd7be51741fac1",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6b725e09_b07e711f",
        "filename": "tools/pci.cpp",
        "patchSetId": 1
      },
      "lineNbr": 139,
      "author": {
        "id": 1001030
      },
      "writtenOn": "2021-02-26T18:38:59Z",
      "side": 1,
      "message": "Yeah, this entire function should essentially be pci-\u003epci_device_enable(dev).",
      "parentUuid": "9dccc5bb_7257076e",
      "range": {
        "startLine": 139,
        "startChar": 15,
        "endLine": 139,
        "endChar": 38
      },
      "revId": "38068f143eb1f174b7ddc27cf6fd7be51741fac1",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "113ed795_272668a7",
        "filename": "tools/pci.cpp",
        "patchSetId": 1
      },
      "lineNbr": 139,
      "author": {
        "id": 1000233
      },
      "writtenOn": "2021-02-26T18:41:10Z",
      "side": 1,
      "message": "It\u0027s just setting the MMIO bit here.\n\nThe Aspeed one enables the bridge through a reserved section of the BAR rather than the config space, so that code will need to stay",
      "parentUuid": "9dccc5bb_7257076e",
      "range": {
        "startLine": 139,
        "startChar": 15,
        "endLine": 139,
        "endChar": 38
      },
      "revId": "38068f143eb1f174b7ddc27cf6fd7be51741fac1",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d0b9931c_8364ea57",
        "filename": "tools/pci.cpp",
        "patchSetId": 1
      },
      "lineNbr": 139,
      "author": {
        "id": 1000590
      },
      "writtenOn": "2021-02-26T20:12:55Z",
      "side": 1,
      "message": "I think you wanted to retain the disable through config space. So if we are doing that, we need this cfg write.",
      "parentUuid": "113ed795_272668a7",
      "range": {
        "startLine": 139,
        "startChar": 15,
        "endLine": 139,
        "endChar": 38
      },
      "revId": "38068f143eb1f174b7ddc27cf6fd7be51741fac1",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "db59e9d7_871dae63",
        "filename": "tools/pci.cpp",
        "patchSetId": 1
      },
      "lineNbr": 139,
      "author": {
        "id": 1000233
      },
      "writtenOn": "2021-02-26T21:24:48Z",
      "side": 1,
      "message": "We should only need it in the disableBridge function, right?\n\nAlso you may want to add a comment there about how pci_disable_device doesn\u0027t exist yet, and that\u0027s why there\u0027s a manual config write",
      "parentUuid": "d0b9931c_8364ea57",
      "range": {
        "startLine": 139,
        "startChar": 15,
        "endLine": 139,
        "endChar": 38
      },
      "revId": "38068f143eb1f174b7ddc27cf6fd7be51741fac1",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "de2420ba_eccc1d79",
        "filename": "tools/pci.cpp",
        "patchSetId": 1
      },
      "lineNbr": 139,
      "author": {
        "id": 1000590
      },
      "writtenOn": "2021-02-26T21:26:50Z",
      "side": 1,
      "message": "Since the disable is directly writing to the config space, the sysfs enable does not keep track of it. so the next time we call the pcienable, it is a no-op. \nIf we are accessing config space directly to disable, we need to have this cfg space enable as well.",
      "parentUuid": "db59e9d7_871dae63",
      "range": {
        "startLine": 139,
        "startChar": 15,
        "endLine": 139,
        "endChar": 38
      },
      "revId": "38068f143eb1f174b7ddc27cf6fd7be51741fac1",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2825b89b_9dc989eb",
        "filename": "tools/pci.cpp",
        "patchSetId": 1
      },
      "lineNbr": 139,
      "author": {
        "id": 1000233
      },
      "writtenOn": "2021-02-26T21:38:39Z",
      "side": 1,
      "message": "That\u0027s a good point. You should document that in a comment too",
      "parentUuid": "de2420ba_eccc1d79",
      "range": {
        "startLine": 139,
        "startChar": 15,
        "endLine": 139,
        "endChar": 38
      },
      "revId": "38068f143eb1f174b7ddc27cf6fd7be51741fac1",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "36f379fe_f5d09194",
        "filename": "tools/pci.cpp",
        "patchSetId": 1
      },
      "lineNbr": 139,
      "author": {
        "id": 1001030
      },
      "writtenOn": "2021-02-28T20:39:34Z",
      "side": 1,
      "message": "You might just add a pci_device_is_enabled() at least the sysfs code in linux lets you query that. You can hide it in the implementation of your class unti you added the code to libpciaccess. At least things can move forward that way.\n\n1. Add function pci_device_disable (essentially open, write, close / echo 0 \u003e /sys/..../enable)\n2. Add function pci_device_is_enabled(essentially open, read, close / cat /sys/.../enable)\n3. Now you can do:\n\nif (!pci_device_is_enabled(...)) {\n  pci_device_enable(...);\n}\n\n...\n\npci_device_disable(...);\n\nIf you insist on disabling it on close.\n\nI don\u0027t think bypassing the refcounting is a good idea.",
      "parentUuid": "2825b89b_9dc989eb",
      "range": {
        "startLine": 139,
        "startChar": 15,
        "endLine": 139,
        "endChar": 38
      },
      "revId": "38068f143eb1f174b7ddc27cf6fd7be51741fac1",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7c00a860_f14ae78a",
        "filename": "tools/pci.cpp",
        "patchSetId": 1
      },
      "lineNbr": 139,
      "author": {
        "id": 1000590
      },
      "writtenOn": "2021-03-08T19:26:39Z",
      "side": 1,
      "message": "I think we cannot have a linux sysfs code in here since this is generic. \nI will update the comments.",
      "parentUuid": "36f379fe_f5d09194",
      "range": {
        "startLine": 139,
        "startChar": 15,
        "endLine": 139,
        "endChar": 38
      },
      "revId": "38068f143eb1f174b7ddc27cf6fd7be51741fac1",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    }
  ]
}